## 资源采集

### cpu使用采集
针对ops或者rd希望看到的数据是当前服务使用了多少cpu，比如40% cpu, 4个核这样的数据, 但是对于操作系统，分配给进程的却是时间片，所以需要一个算法将时间转换为
cpu使用率或者核数，在讲计算算法之前，现介绍两个系统文件
* /proc/stat
* cpuacct.stat

#### /proc/stat
/proc/stat是内核proc文件系统的一个文件，它主要记录了cpu时间使用量，分别包含整个和单个cpu时间使用量，还记录了相关
进程信息，下面是一个/proc/stat文件内容
```
[root@~]# cat /proc/stat
cpu  92597 36 40249 11386688 4861 0 18 2504 0
cpu0 32875 9 11056 2832533 4231 0 16 636 0
cpu1 19575 9 9755 2851867 110 0 0 631 0
cpu2 21588 9 10137 2849097 258 0 1 626 0
cpu3 18558 7 9300 2853190 261 0 0 609 0
intr 21196636 115 7 0 0 0 0 0 0 1 2 0 33 104 0 0 68 0 0 0 0 0 0 0 0 0 26469 0 336 0 338 0 21557 2 0 21133 2 0 197 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
ctxt 61372783
btime 1460949413
processes 14531
procs_running 1
procs_blocked 0
softirq 4705061 0 1759667 0 42537 17 0 2 1088242 21541 1793055

```
对于cpu资源采集，只需要cpu相关信息，从文件内容来看，cpu使用时间有很多属性，属性之间使用空格隔开
* 第一列, cpu 表示整体cpu使用统计
* 第二列, 92579 user表示所有进程在用户态消耗的cpu时间
* 第三列, 36 nice表示低优先级进程在用户态消耗的cpu时间
* 第四列, 40249 system表示系统调用消耗的时间，这个是在内核态
* 第五列，11386688 idle表示cpu处于空闲时间
* 第六列，4861 iowait表示用于等待io完成消耗的时间
* 第七列，0 irq表示中断消耗的时间
* 第八列，18 softirq 表示软中断消耗时间
* 第九列，2504 steal 表示运行其他操作系统消耗时间，比如运行kvm

每个属性都是一个计数，表示总共消耗多少时间，但是采集需要知道cpu使用率或者cpu使用核数，这里只能周期来计算出cpu使用率，
比如计算1秒内，使用多少cpu时间，总共有多少cpu时间,计算整机cpu使用率可以使用一下公式:


